<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>trove.com</title>
    <link href="https://unpkg.com/wavesurfer.js@5.2.0/dist/wavesurfer.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Langar&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>

        *{
            font-family: 'Langar';
        }
        
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 0;
            background: rgb(33,37,41);
        }
        .container-fluid{
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            h2{
                color: red ;
                text-align: center;
                
                font-size: 40px;
            }
        }
        .main_functions{
            width: 100%;
            height: 90vh;
            display: flex;
            justify-content: space-between;
            gap: 2em;
            align-items: center;
            
        }
        .Trimming_area{
            border: 2px dashed blueviolet;
            width: 60%;
            height:80vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
         h2{
            color: #fff;
            font-size: 30pxx;
            text-align: center;
         }
        .drop-area {
            width: 90%;
            height: 200px;
            font-size: 20px;
            color: white;
            border: 2px dashed #4F4A85;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            background-color: transparent;
            cursor: pointer;
        }
        .drop-area.hover {
            border-color: #383351;
        }
        .waveform {
            width: 80%;
            height: 200px;
            background-color: #e0e0e0a3;
            margin-top: 20px;
            overflow: none;
        }
        .controls {
            margin-top: 20px;
            display: flex;
        }
        button {
            border-radius:10px ;
            margin: 5px;
            padding: 10px;
            font-size: 20px;
            background-color: #ffff;
        }
        #downloadLink{
                text-decoration: none;
                color: white;
        }
       
    }
        .searchbox{
            border: 1px dashed green ;
            width: 20%;
            height: 80vh;
            display: flex;
            flex-direction: column;
            justify-content: start;
            align-items: center;
            
            h2{
                text-align: center;
            }
            input{
                height: 30px;
                margin: 20px;
            }
            #songList{
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content:center;
                /*background-color: aqua; */
                .song{
                    color: white;
                }
            }

        }
        .downloaded_lists{
            width: 20%;
            height: 80vh;
            border: 2px dashed yellow;
            h3{
                text-align: center;
            }
        }
        #cont{
            height: fit-content;
              background: rgb(33,37,41); 
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            backdrop-filter: blur(6px);
                -webkit-backdrop-filter: blur(6px);
            margin-bottom: 30px;
          } 
        .navbar{
            width:90em;
            height:60px;
            display:flex;
            flex-direction:column;
            gap:20px;
            justify-content:space-between;
            align-items:center;
            button{
               /* background: linear-gradient(to right,rgb(33,37,41),rgb(76, 71, 71),rgb(33,37,41)); */
               background-color: transparent;
                border:2px solid rgb(57, 56, 56);
                z-index: 1;
                transition: 0.2s ease-in-out;
                box-shadow: 0px 0px 1000px 10px #656363;
                color: #fff;
                font-size: 15px;
                width: 120px;
                height: 45px;
                border-radius: 10px;
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
            }
            button:hover{
                border: 2px solid rgb(100,100,100);
                transform: rotateY(0deg);
            }
           
         }
            .navbar-brand{
                font-family:'Langar';
                display:flex;
                flex-direction:row;
                width:100px;
                justify-content:end;
                align-items:center;
                background-color:transparent;
                font-size:20px;
                color:#ffffff;
                h2{
                    color: #fff;
                    font-size: 30px;
                }
                /* box-shadow: 0px 0px 100px 10px #656363; */
        
                img{
                    width:30px;
                    height:30px;
                    background-color: aqua;
                }
            }
             .navbar-brand:hover{
                color: white;
             }
            #nav_ul{
                display:flex;
                flex-direction:row;
                justify-content: space-between;
                border-radius:  20px;
                opacity: 1;
                gap:2em;
                width: fit-content;
                height:35px;
                padding-left: 20px;
                padding-right: 20px;
                align-items: center;
                transition: 0.8s ease-in-out;
                /* background: linear-gradient(120deg,rgb(85, 86, 86),rgb(116, 116, 116),rgb(85, 86, 86)); */
                background-color: transparent;
                backdrop-filter: blur(10px);
                border: 1px black solid;
                -webkit-backdrop-filter: blur(10px);
                box-shadow:  0px 2px 100px rgba(224, 222, 222, 0.37);
                a{
                    color:#fff;
                    text-decoration: none;
                }
                a:hover{
                    /* font-weight: bold; */
                    text-shadow: 0 0 10px #000000;        }
                /* box-shadow: 0px 0px 20px 10px #636363; */
        
            }
           
    </style>
</head>
<body>
   
    
        
    <div class="main_functions">
        <div class="searchbox">
          <h2 class="text-white">Search here..</h2>
          <input type="text" id="searchInput" placeholder="Search songs...">
              <div id="songList">
              </div>
        </div>  
  
      <div class="Trimming_area">
          <h2>Trim Here</h2>
  
      <div class="drop-area" id="dropArea">Drag & Drop Audio Here</div>
      <div class="waveform" id="waveform"></div>
      <div class="controls">
          <button id="trimButton">Trim Audio</button>
          <button id="playButton">Play Trimmed Audio</button>
      </div>
      <a id="downloadLink" style="display: none;">Download Trimmed Audio</a></div>
  
      <div class="downloaded_lists">
        <h3 class="text-secondary">Downloaded List</h3>
        <div id="downloadedList"></div>
        <hr>
      </div>
  
      </div>
   

    <script src="https://unpkg.com/wavesurfer.js@5.2.0/dist/wavesurfer.min.js"></script>
    <script src="https://unpkg.com/wavesurfer.js@5.2.0/dist/plugin/wavesurfer.regions.min.js"></script>
    <script>
        //this to add the donwloaded songs to the downloaded lists
        
        
        function addToDownloadedList(trimmedAudioUrl, trimmedAudioTitle) {
            const downloadedList = document.querySelector('.downloaded_lists');
            const audioContainer = document.createElement('div');
            audioContainer.classList.add('downloaded-audio-container');
            
            const audioTitle = document.createElement('h4');
            audioTitle.textContent = trimmedAudioTitle;
        
            const audioElement = document.createElement('audio');
            audioElement.src = trimmedAudioUrl;
            audioElement.controls = true;
        
            audioContainer.appendChild(audioTitle);
            audioContainer.appendChild(audioElement);
            
            downloadedList.appendChild(audioContainer);
        }
        
        document.getElementById('downloadLink').addEventListener('click', function(event) {
            event.preventDefault();
            const trimmedAudioUrl = this.href;
            const trimmedAudioTitle = this.textContent;
            addToDownloadedList(trimmedAudioUrl, trimmedAudioTitle);
            downloadTrimmedAudio(trimmedAudioUrl, trimmedAudioTitle);
        });
        
        function downloadTrimmedAudio(trimmedAudioUrl, trimmedAudioTitle) {
            const tempAnchor = document.createElement('a');
            tempAnchor.href = trimmedAudioUrl;
            tempAnchor.download = trimmedAudioTitle;
        
            document.body.appendChild(tempAnchor);
            tempAnchor.click();
        
            document.body.removeChild(tempAnchor);
        }
        

      
        const songList = document.getElementById('songList');
        const dArea = document.getElementById('dropArea');

        // Sample songs data
        const songs = [
            { name: 'Baitikochi Chuste', url: '../songs/[iSongs.info] 01 - Vellake.mp3' },
            { name: 'Chilaka', url: './love_songs/[iSongs.info] 01 - Chilaka.mp3' },
            { name: 'Evare', url: './love_songs/[iSongs.info] 01 - Evare.mp3' },
            { name: 'Mella Mellagaa', url: './love_songs/[iSongs.info] 01 - Mella Mellagaa.mp3' },
            { name: 'Ninnila', url: './love_songs/[iSongs.info] 01 - Ninnila.mp3' },
            { name: 'Teliyadhe', url: './love_songs/[iSongs.info] 01 - Teliyadhe.mp3' },
            // Add more songs as needed
        ];

        // Populate song list
        songs.forEach(song => {
            const songElement = document.createElement('div');
            songElement.className = 'song';
            songElement.textContent = song.name;
            songElement.draggable = true;
            songElement.addEventListener('dragstart', (event) => {
                event.dataTransfer.setData('text/plain', song.url);
            });
            songList.appendChild(songElement);
        });
        // Drop area event listener
dArea.addEventListener('drop', (event) => {
    event.preventDefault();
    dArea.classList.remove('hover');
    const songUrl = event.dataTransfer.getData('text/plain');
    if (songUrl) {
        // Load the selected audio file into WaveSurfer and display the waveform
        wavesurfer.load(songUrl);
    }
});
dArea.addEventListener('drop', (event) => {
    event.preventDefault();
    dArea.classList.remove('hover');
    const songUrl = event.dataTransfer.getData('text/plain');
    console.log(songUrl);
    const draggedSong = songs.find(song => song.url === songUrl);
    if (draggedSong) {
        dArea.value = draggedSong.name;
        wavesurfer.load(songUrl);
    }
});

dArea.addEventListener('drop', (event) => {
    event.preventDefault();
    dArea.classList.remove('hover');
    const songUrl = event.dataTransfer.getData('text/plain');
    if (songUrl) {
        // Remove the existing song from the drag area
        dArea.innerHTML = '';
        // Load the selected audio file into WaveSurfer and display the waveform
        wavesurfer.load(songUrl);
    }
});

        // Drop area event listeners
        dArea.addEventListener('dragover', (event) => {
            event.preventDefault();
            dArea.classList.add('hover');
        });

        dArea.addEventListener('dragleave', () => {
            dArea.classList.remove('hover');
        });

        dArea.addEventListener('drop', (event) => {
            event.preventDefault();
            dArea.classList.remove('hover');
            const songUrl = event.dataTransfer.getData('text/plain');
            if (songUrl) {
                // You can now use the dropped song URL for further processing
                console.log('Dropped song URL:', songUrl);
            }
        });




        //this to create the trimmed song
        const dropArea = document.getElementById('dropArea');
        const waveformContainer = document.getElementById('waveform');
        /*const trimButton = document.getElementById('trimButton');*/
        const playButton = document.getElementById('playButton');

        let wavesurfer = WaveSurfer.create({
            container: waveformContainer,
            waveColor: '#4F4A85',
            progressColor: '#383351',
            cursorWidth: 2,
            barWidth:5,
            height: 200,
            width:500,
            plugins: [
                WaveSurfer.regions.create()
            ], minPxPerSec: 100
        });
        

        dropArea.addEventListener('dragover', (event) => {
            event.preventDefault();
            dropArea.classList.add('hover');
        });

        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('hover');
        });

        dropArea.addEventListener('drop', (event) => {
            event.preventDefault();
            dropArea.classList.remove('hover');
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('audio/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        wavesurfer.loadBlob(file);
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        wavesurfer.on('ready', () => {
            wavesurfer.addRegion({
                start: 0,
                end: 10,
                color: 'rgba(0, 0, 0, 0.1)'
            });
        });

        /*trimButton.addEventListener('click', () => {
            const region = Object.values(wavesurfer.regions.list)[0];
            if (region) {
                const startTime = region.start;
                const endTime = region.end;
                
                wavesurfer.exportPCM(1024, wavesurfer.backend.sampleRate, false, startTime, endTime).then(pcmData => {
                    const mp3Blob = encodePCMToMP3(pcmData);
                    downloadBlob(mp3Blob, 'trimmed_audio.mp3');
                });
            }
        });*/

        playButton.addEventListener('click', () => {
            const region = Object.values(wavesurfer.regions.list)[0];
            if (region) {
                wavesurfer.play(region.start, region.end);
            }
        });

        document.getElementById('trimButton').addEventListener('click', function() {
            const region = Object.values(wavesurfer.regions.list)[0];
            if (region) {
                const start = region.start;
                const end = region.end;
                trimAudio(wavesurfer.backend.buffer, start, end);
            } else {
                alert('Please select a region to trim.');
            }
        });
        //trimming
        function trimAudio(buffer, start, end) {
            const sampleRate = buffer.sampleRate;
            const startSample = Math.floor(start * sampleRate);
            const endSample = Math.floor(end * sampleRate);
            const trimmedAudio = buffer.getChannelData(0).slice(startSample, endSample);

            const wavBlob = encodeWAV(trimmedAudio, sampleRate);
            const downloadLink = document.getElementById('downloadLink');
            const url = URL.createObjectURL(wavBlob);
            downloadLink.href = url;
            downloadLink.download = 'trimmed_audio.mp3';
            downloadLink.style.display = 'block';
            downloadLink.innerHTML = 'Download Trimmed Audio';
        }

        function encodeWAV(samples, sampleRate) {
            const buffer = new ArrayBuffer(44 + samples.length * 2);
            const view = new DataView(buffer);

            function writeString(view, offset, string) {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            }

            function floatTo16BitPCM(output, offset, input) {
                for (let i = 0; i < input.length; i++, offset += 2) {
                    const s = Math.max(-1, Math.min(1, input[i]));
                    output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
                }
            }

            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + samples.length * 2, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, 1, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(view, 36, 'data');
            view.setUint32(40, samples.length * 2, true);

            floatTo16BitPCM(view, 44, samples);

            return new Blob([view], { type: 'audio/mp3' });
        }
    </script>
</body>
</html>



